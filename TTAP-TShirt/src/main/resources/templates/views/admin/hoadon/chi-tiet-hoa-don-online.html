<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TTAP</title>
    <link rel="stylesheet" href="/customcss/banhang.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.css">
    <link rel="stylesheet" href="/customcss/toastMessage.css ">

</head>
<body class="hold-transition skin-blue sidebar-mini">
<!-- Site wrapper -->
<div>

    <div th:replace="~{/fragment/sidebar :: sidebar}"></div>
    <div class="main-content content flex-grow-1 p-4">
        <div class="d-flex">
            <a th:href="@{/admin/hoa-don/hien-thi}" class="fw-medium fs-5 text-black" style="text-decoration:none">Hoá đơn</a>
            <a>&nbsp / &nbsp</a>
            <a href="" class="fw-bolder fs-5 text-black" style="text-decoration: none">Hóa đơn chi tiết</a>
        </div>
        <div id="toast-root"></div>
        <div style="width: 80%; margin: auto; position: relative;">
            <h2 style="font-size: 30px; text-align: center;" th:text="'Theo dõi đơn hàng: '+${hoaDon.ma}"></h2>
            <label th:text="${hoaDon.trangThai}"></label>
            <br>

            <!-- Progress Bar -->
            <div style="position: absolute; top: 140px; left: 8%; width: calc(100% - 16%); height: 4px; background-color: #ccc; z-index: -1;">
                <!-- Active Progress -->
                <div style="height: 4px; background-color: #00aaff;"
                     th:style="'width:' + (hoaDon.trangThai == 1 ? '100%' : (hoaDon.trangThai == 8 ? '80%' : (hoaDon.trangThai == 7 ? '60%' : (hoaDon.trangThai == 6 ? '40%' : '20%'))))"></div>
            </div>

            <div style="display: flex; justify-content: space-around; margin-top: 20px;">
                <!-- Step 1: Chờ xác nhận -->
                <div style="text-align: center; width: 150px; position: relative;">
                    <div style="width: 90px; height: 90px; color: white; border-radius: 50%;
                display: flex; justify-content: center; align-items: center; margin: 0 auto 10px; font-size: 30px;"
                         th:classappend="${hoaDon.trangThai == 1 || hoaDon.trangThai >= 3 ? 'bg-warning' : 'bg-secondary'}">
                        <i class="fas fa-exclamation"></i>
                    </div>
                    <p>Chờ xác nhận</p>
<!--                    <span style="font-size: 12px; color: gray;">29-04-2024 19:58:26</span>-->
                </div>

                <!-- Step 2: Đã xác nhận -->
                <div style="text-align: center; width: 150px; position: relative;">
                    <div style="width: 90px; height: 90px; border-radius: 50%; color: white;
                display: flex; justify-content: center; align-items: center; margin: 0 auto 10px; font-size: 30px;"
                         th:classappend="${hoaDon.trangThai == 1 || hoaDon.trangThai >= 6 ? 'bg-primary' : 'bg-secondary'}">
                        <i class="fas fa-check"></i>
                    </div>
                    <p>Đã xác nhận</p>
<!--                    <span style="font-size: 12px; color: gray;">29-04-2024 20:01:28</span>-->
                </div>

                <!-- Step 3: Chờ giao hàng -->
                <div style="text-align: center; width: 150px; position: relative;">
                    <div style="width: 90px; height: 90px; border-radius: 50%; color: white;
                display: flex; justify-content: center; align-items: center; margin: 0 auto 10px; font-size: 30px;"
                         th:classappend="${hoaDon.trangThai == 1 || hoaDon.trangThai >= 7 ? 'bg-primary' : 'bg-secondary'}">
                        <i class="fas fa-truck"></i>
                    </div>
                    <p>Chờ giao hàng</p>
<!--                    <span style="font-size: 12px; color: gray;">29-04-2024 20:01:51</span>-->
                </div>

                <!-- Step 4: Đang giao hàng -->
                <div style="text-align: center; width: 150px; position: relative;">
                    <div style="width: 90px; height: 90px; border-radius: 50%; color: white;
                display: flex; justify-content: center; align-items: center; margin: 0 auto 10px; font-size: 30px;"
                         th:classappend="${hoaDon.trangThai == 1 || hoaDon.trangThai == 8 ? 'bg-primary' : 'bg-secondary'}">
                        <i class="fas fa-shipping-fast"></i>
                    </div>
                    <p>Đang giao hàng</p>
<!--                    <span style="font-size: 12px; color: gray;">29-04-2024 20:02:09</span>-->
                </div>

                <!-- Step 5: Hoàn thành -->
                <div style="text-align: center; width: 150px; position: relative;">
                    <div style="width: 90px; height: 90px; border-radius: 50%; color: white;
                display: flex; justify-content: center; align-items: center; margin: 0 auto 10px; font-size: 30px;"
                         th:classappend="${hoaDon.trangThai == 1 ? 'bg-success' : 'bg-secondary'}">
                        <i class="fas fa-flag-checkered"></i>
                    </div>
                    <p>Hoàn thành</p>
<!--                    <span style="font-size: 12px; color: gray;">29-04-2024 20:02:27</span>-->
                </div>
            </div>
        </div>


    </div>
    <br>
    <br>
    <button
            class="btn btn-info"
            style="border-radius: 12px; width: 140px; height: 40px; margin: 0 10px; color: white; border: none;position: absolute;right: 200px;top: 350px"
    >Lịch sử</button>
    <div class="row" style="margin-left: 520px">
        <!-- Button: Xác nhận đơn -->
        <button
                th:if="${hoaDon.trangThai == 3}"
                style="border-radius: 12px; width: 140px; height: 40px; margin: 0 10px; background-color: #007bff; color: white; border: none;"
                th:onclick="|confirmAction('/admin/hoa-don/xac-nhan-hoa-don/' + ${hoaDon.id}, 'Xác nhận đơn hàng?')|">
            Xác nhận đơn
        </button>

        <!-- Button: Chờ giao hàng -->
        <button
                th:if="${hoaDon.trangThai == 6}"
                style="border-radius: 12px; width: 140px; height: 40px; margin: 0 10px; background-color: #28a745; color: white; border: none;"
                th:onclick="|confirmAction('/admin/hoa-don/hoa-don-cho-giao-hang/' + ${hoaDon.id}, 'Chờ giao hàng?')|">
            Chờ giao hàng
        </button>

        <!-- Button: Đang giao hàng -->
        <button
                th:if="${hoaDon.trangThai == 7}"
                style="border-radius: 12px; width: 140px; height: 40px; margin: 0 10px; background-color: #17a2b8; color: white; border: none;"
                th:onclick="|confirmAction('/admin/hoa-don/xac-nhan-dang-giao-hang/' + ${hoaDon.id}, 'Xác nhận đơn hàng đang vận chuyển?')|">
            Đang giao hàng
        </button>

        <!-- Button: Hoàn thành -->
        <button
                th:if="${hoaDon.trangThai == 8}"
                style="border-radius: 12px; width: 140px; height: 40px; margin: 0 10px; background-color: #ffc107; color: black; border: none;"
                th:onclick="|confirmAction('/admin/hoa-don/hoan-thanh-hoa-don/' + ${hoaDon.id}, 'Hoàn thành đơn hàng (chắc chắn rằng khách hàng đã thanh toán!)?')|">
            Hoàn thành
        </button>

        <!-- Button: Hủy đơn hàng -->
        <button
                th:if="${hoaDon.trangThai == 3}"
                style="border-radius: 12px; width: 140px; height: 40px; margin: 0 10px; background-color: white; color: #dc3545; border: 1px solid #dc3545;"
                th:onclick="|confirmAction('/admin/hoa-don/huy-hoa-don-online/' + ${hoaDon.id}, 'Hủy hóa đơn này?')|">
            Hủy đơn hàng
        </button>
    </div>





    <br>
    <hr>
    <br>

    <div style="flex-wrap: wrap; gap: 20px; font-family: Arial, sans-serif; margin: 40px;margin-left: 320px">
        <!-- Danh sách sản phẩm -->
        <div style="background: #f8f9fa; border: 1px solid #ddd; border-radius: 8px; padding: 20px;">
            <h3 style="margin: 0 0 20px; font-size: 18px;">Danh sách sản phẩm</h3>
            <hr>
            <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                <thead>
                <tr style="background-color: #f1f1f1;">
                    <th style="padding: 10px; border: 1px solid #ddd;">Hình ảnh</th>
                    <th style="padding: 10px; border: 1px solid #ddd;">Tên sản phẩm</th>
                    <th style="padding: 10px; border: 1px solid #ddd;">Mã sản phẩm</th>
                    <th style="padding: 10px; border: 1px solid #ddd;">Kiểu dáng</th>
                    <th style="padding: 10px; border: 1px solid #ddd;">Thương hiệu</th>
                    <th style="padding: 10px; border: 1px solid #ddd;">Màu Sắc</th>
                    <th style="padding: 10px; border: 1px solid #ddd;">Size</th>
                    <th style="padding: 10px; border: 1px solid #ddd;">Giá bán</th>
                    <th style="padding: 10px; border: 1px solid #ddd;">Số lượng mua</th>
                    <th style="padding: 10px; border: 1px solid #ddd;">Thành tiền</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="hdct : ${listSPOrder}">
                    <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">
                        <img src="https://res.cloudinary.com/dld7uoqyh/image/upload/v1728726810/productImg/bbe9a9e0-9b71-45cc-b1c1-778fba4b2a25.jpg"
                             alt="Product Image"
                             style="width: 50px; height: 50px; object-fit: cover; border-radius: 8px;"/>
                    </td>
                    <td style="padding: 10px; border: 1px solid #ddd;" th:text="${hdct.chiTietSanPham.sanPham.ten}">Áo thun fpt</td>
                    <td style="padding: 10px; border: 1px solid #ddd;" th:text="${hdct.chiTietSanPham.sanPham.ma}">SP95226</td>
                    <td style="padding: 10px; border: 1px solid #ddd;" th:text="${hdct.chiTietSanPham.sanPham.kieuDang.ten}">Sành điệu</td>
                    <td style="padding: 10px; border: 1px solid #ddd;" th:text="${hdct.chiTietSanPham.sanPham.thuongHieu.ten}">Puma</td>
                    <td style="padding: 10px; border: 1px solid #ddd;" th:text="${hdct.chiTietSanPham.mauSac.ten}">M</td>
                    <td style="padding: 10px; border: 1px solid #ddd;" th:text="${hdct.chiTietSanPham.kichCo.ten}">M</td>
                    <td style="padding: 10px; border: 1px solid #ddd; color: red;" th:text="${numberUtils.formatCurrency(hdct.chiTietSanPham.giaBan)}">300,000 đ</td>
                    <td style="padding: 10px; border: 1px solid #ddd;" th:text="${hdct.soLuong}">4</td>
                    <td style="padding: 10px; border: 1px solid #ddd; color: red; text-align: right;"
                        th:text="${numberUtils.formatCurrency(hdct.chiTietSanPham.giaBan * hdct.soLuong)}">1,200,000 đ</td>
                </tr>
                </tbody>
            </table>
        </div>

    </div>


    <br>
    <!-- Thông tin hóa đơn -->
    <div style="flex: 1; min-width: 300px; background: #f8f9fa; border: 1px solid #ddd; border-radius: 8px; padding: 20px;margin-left: 320px">
        <div style="margin-bottom: 10px; display: flex; justify-content: space-between;">
            <p style="margin: 0; font-size: 14px;">Mã giảm giá:</p>
            <span style="font-size: 14px;" th:text="${hoaDon.soTienGiamGia!=null?numberUtils.formatCurrency(hoaDon.soTienGiamGia):'Không áp dụng'}"></span>
        </div>
        <div style="margin-bottom: 10px; display: flex; justify-content: space-between;">
            <p style="margin: 0; font-size: 14px;">Tổng tiền hàng:</p>
            <span style="font-size: 14px;"  th:text="'Tổng tiền sản phẩm: '+${numberUtils.formatCurrency(hoaDon.tongTien)}"></span>
        </div>
        <div style="margin-bottom: 10px; display: flex; justify-content: space-between;">
            <p style="margin: 0; font-size: 14px;">Giảm giá:</p>
            <span style="font-size: 14px;">Không áp dụng</span>
        </div>
        <div style="margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
            <p style="margin: 0; font-size: 14px;">Phí vận chuyển:</p>
            <span type="text"
                   style="padding: 5px; font-size: 14px; width: 80px; text-align: right; border: 1px solid #ddd; border-radius: 4px;">50000</span>
        </div>
        <div style="margin-top: 20px; display: flex; justify-content: space-between; font-weight: bold; font-size: 16px;">
            <p style="margin: 0;">Tổng tiền:</p>
            <label style="color: red;" th:text="'Tổng tiền thanh toán: '+${numberUtils.formatCurrency((hoaDon.tongTien)+50000)}"></label>
        </div>
    </div>
</div>
</div>
<br>
<br>

<script src="/js/sweetalert.min.js"></script>
<script src="/js/toastMessage.js"></script>
<script>
    // JavaScript function to show SweetAlert and handle confirmation
    function confirmAction(url, actionName) {
        swal({
            title: "Xác nhận",
            text: "Bạn có chắc chắn muốn " + actionName + " hóa đơn này không.",
            icon: "warning",
            buttons: true,
            dangerMode: true,
        })
            .then((willProceed) => {
                if (willProceed) {
                    // Redirect if confirmed
                    window.location.href = url;
                }
            });
    }

    function toastSuccess(title, message) {
        // Assuming you're using a library like Toastify or another toast library
        Toastify({
            text: message,
            duration: 3000, // duration in ms
            close: true,
            gravity: "top", // position: top or bottom
            position: "right", // position: left, center, right
            backgroundColor: "green", // customize color as needed
            stopOnFocus: true // stops the toast from disappearing when hovered
        }).showToast();
    }

</script>
<!-- Display Toast on Success -->
<script th:if="${successMessage}">
    toastSuccess('Success', "thao tác đơn hàng thành công !");
</script>

</body>
</html>
