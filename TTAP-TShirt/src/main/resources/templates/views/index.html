<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>TTAP T-SHIRT</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,700" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" />
    <link rel="shortcut icon" type="image/png"
          th:href="@{/images/logo2tap.jpg}" />
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;600;900&display=swap" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link th:href="@{/customercss/bootstrap.min.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{/customercss/elegant-icons.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{/customercss/nice-select.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{/customercss/jquery-ui.min.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{/customercss/owl.carousel.min.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{/customercss/slicknav.min.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{/customercss/style.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{/customercss/style-customer.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{/customercss/cart-hover.css}" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="/customcss/toastMessage.css ">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css" rel="stylesheet"
          type="text/css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        h1, h3 {
            margin-bottom: 20px;
        }
        table {
            background-color: #fff;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        table th, table td {
            text-align: center;
        }
        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }
        footer {
            background-color: #343a40;
            color: #fff;
            padding: 20px 0;
        }

    </style>
</head>
<body>
<header th:replace="~{/fragment/header-customer :: header-customer}"></header>
<div id="toast-root"></div>
<div class="cart-content-2021">
    <div class="cart-content-2021-left">
        <div class="container my-4">
            <div class="row">
                <!-- Cart Items Section -->
                <div class="col-md-9">
                    <div class="d-flex border-bottom pb-4">
                        <div class="col-md-4 d-flex align-items-center">
                            <input type="checkbox" class="form-check-input me-2" id="js-check-cart-all-item" onclick="checkAllItemProductCart(this)">
                            <span>Tất cả (<span class="cart_counter_new">0</span> sản phẩm)</span>
                        </div>
                        <div class="col-md-2 text-center fw-bold">Đơn giá</div>
                        <div class="col-md-2 text-center fw-bold">Số lượng</div>
                        <div class="col-md-2 text-center fw-bold">Thành tiền</div>
                        <div class="col-md-2 text-centerfw-bold">
                            <a href="javascript:void(0);" class="btn btn-danger btn-sm" onclick="removeAllItemsFromCart()">
                                <i class="bi bi-trash"></i> Xóa toàn bộ
                            </a>
                        </div>
                    </div>

                    <div class="mt-3">
                        <!-- Single Item Row -->
                        <div class="row align-items-center border-bottom py-2 js-item-row">
                            <!-- Checkbox và Hình ảnh sản phẩm -->
                            <div class="col-6 col-md-4 d-flex align-items-center px-1">
                                <input type="checkbox" class="form-check-input me-3 js-check-cart-item">
                                <img src="https://hanoicomputercdn.com/media/product/250_84332_pc_dell_inspiron_3030s_sffi33003w1_8g_512g_1a.jpg"
                                     alt="Product Image"
                                     class="img-thumbnail me-3"
                                     style="width: 80px; height: 80px; object-fit: contain;">
                                <div>
                                    <a href="#" class="text-dark fw-bold">PC Dell Inspiron 3030S</a>
                                    <p class="small text-muted mb-1">Mã SP: <b>PCDE927</b></p>
                                    <p class="small text-success">MUA LẺ GIÁ SỈ</p>
                                    <a href="javascript:void(0);" class="btn btn-link p-0">Lưu lại mua sau</a>
                                </div>
                            </div>

                            <!-- Giá sản phẩm -->
                            <div class="col-4 col-md-2 text-center px-1">
                                <span class="fw-normal">12.299.000₫</span>
                            </div>

                            <!-- Số lượng sản phẩm -->
                            <div class="col-4 col-md-2 text-center px-1">
                                <div class="d-flex align-items-center justify-content-center">
                                    <button class="btn btn-sm btn-outline-secondary" onclick="updateQuantity(-1)">-</button>
                                    <input type="text"
                                           class="form-control form-control-sm text-center mx-2"
                                           value="1"
                                           style="width: 50px;">
                                    <button class="btn btn-sm btn-outline-secondary" onclick="updateQuantity(1)">+</button>
                                </div>
                            </div>

                            <!-- Thành tiền -->
                            <div class="col-4 col-md-2 text-center px-1">
                                <span class="fw-bold text-danger">12.299.000₫</span>
                            </div>

                            <!-- Nút xóa sản phẩm -->
                            <div class="col-4 col-md-2 text-center px-1">
                                <a href="javascript:void(0);" class="btn btn-danger btn-sm" onclick="removeItemFromCart(this)">
                                    <i class="bi bi-trash"></i> Xóa
                                </a>
                            </div>
                        </div>
                        <!-- End Single Item Row -->
                    </div>
                </div>
                <!-- Cart Summary Section -->
                <div class="col-md-3">
                    <div class="p-3 border rounded">
                        <div class="mb-3">
                            <label for="discount_code" class="form-label">Mã giảm giá/Quà tặng</label>
                            <div class="input-group">
                                <input type="text" id="discount_code" class="form-control" placeholder="Nhập mã giảm giá">
                                <button class="btn btn-primary js-apply-discount-code">Áp dụng</button>
                            </div>
                            <small id="js-voucher-message" class="text-danger"></small>
                        </div>
                        <div class="border-top pt-3">
                            <p class="d-flex justify-content-between mb-2">
                                <span>Tạm tính</span>
                                <span class="total-cart-price">0₫</span>
                            </p>
                            <p class="d-flex justify-content-between mb-2">
                                <span>Giảm giá</span>
                                <span id="price-discount">0₫</span>
                            </p>
                            <p class="d-flex justify-content-between fw-bold mb-2">
                                <span>Thành tiền</span>
                                <span class="text-danger total-cart-payment">0₫</span>
                            </p>
                            <small class="text-muted">(Đã bao gồm VAT nếu có)</small>
                        </div>
                        <button class="btn btn-success w-100 mt-3" onclick="gotoCartStep3();">Tiến hành đặt hàng</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
        <script>
    // document.addEventListener('DOMContentLoaded', function () {
    //     // Kiểm tra khi submit form giỏ hàng
    //     document.getElementById('cartForm').addEventListener('submit', function (event) {
    //         let checkboxes = document.querySelectorAll('.product-checkbox:checked');
    //         if (checkboxes.length === 0) {
    //             event.preventDefault(); // Ngăn việc submit form
    //             alert("Vui lòng chọn ít nhất một sản phẩm để thanh toán.");
    //         }
    //     });
    // });
    //
    // function calculateTotal1() {
    //     let checkboxes = document.querySelectorAll('.product-checkbox');
    //     let total = 0;
    //
    //     // Lọc những sản phẩm được chọn
    //     let selectedProductIds = [];
    //     checkboxes.forEach(checkbox => {
    //         if (checkbox.checked) {
    //             selectedProductIds.push(checkbox.value);
    //
    //             // Xác định dòng chứa checkbox và lấy giá tiền
    //             let row = checkbox.closest('tr');
    //             let amountElement = row.querySelector('td:nth-child(9)');
    //             if (amountElement) {
    //                 let amountText = amountElement.textContent.replace(/[^\d,]/g, ''); // Loại bỏ ký tự không phải số hoặc dấu phẩy
    //                 amountText = amountText.replace(/,/g, '.'); // Thay dấu phẩy (nếu có) thành dấu chấm (do parseFloat cần dấu chấm)
    //                 let amount = parseFloat(amountText); // Chuyển chuỗi thành số
    //                 if (!isNaN(amount)) {
    //                     total += amount;
    //                 }
    //             }
    //         }
    //     });
    //
    //     // Cập nhật tổng tiền
    //     document.getElementById('totalAmount').textContent = formatCurrency(total);
    //
    //     // Xử lý input hidden để lưu các sản phẩm đã chọn
    //     let cartForm = document.getElementById('cartForm');
    //     let inputSelectedProductIds = cartForm.querySelector('input[name="selectedProductIds"]');
    //     if (!inputSelectedProductIds) {
    //         inputSelectedProductIds = document.createElement('input');
    //         inputSelectedProductIds.type = 'hidden';
    //         inputSelectedProductIds.name = 'selectedProductIds';
    //         cartForm.appendChild(inputSelectedProductIds);
    //     }
    //
    //     // Cập nhật giá trị của input hidden
    //     inputSelectedProductIds.value = selectedProductIds.join(',');
    // }
    //
    // function calculateTotal() {
    //     let checkboxes = document.querySelectorAll('.product-checkbox');
    //     let total = 0;
    //
    //     // Lọc những sản phẩm được chọn
    //     let selectedProductIds = [];
    //     checkboxes.forEach(checkbox => {
    //         if (checkbox.checked) {
    //             selectedProductIds.push(checkbox.value);
    //
    //             // Xác định dòng chứa checkbox và lấy giá tiền
    //             let row = checkbox.closest('tr');
    //             let amountElement = row.querySelector('td:nth-child(9)');
    //             if (amountElement) {
    //                 let amountText = amountElement.textContent.replace(/[^0-9,]+/g, ""); // Loại bỏ ký tự không phải số hoặc dấu phẩy
    //                 amountText = amountText.replace(/,/g, '.'); // Thay dấu phẩy (nếu có) thành dấu chấm (do parseFloat cần dấu chấm)
    //                 let amount = parseFloat(amountText); // Chuyển chuỗi thành số
    //                 if (!isNaN(amount)) {
    //                     total += amount;
    //                 }
    //             }
    //         }
    //     });
    //
    //     // Cập nhật tổng tiền
    //     document.getElementById('totalAmount').textContent = formatCurrency(total);
    //
    //     // Xử lý input hidden để lưu các sản phẩm đã chọn
    //     let cartForm = document.getElementById('cartForm');
    //     let inputSelectedProductIds = cartForm.querySelector('input[name="selectedProductIds"]');
    //     if (!inputSelectedProductIds) {
    //         inputSelectedProductIds = document.createElement('input');
    //         inputSelectedProductIds.type = 'hidden';
    //         inputSelectedProductIds.name = 'selectedProductIds';
    //         cartForm.appendChild(inputSelectedProductIds);
    //     }
    //
    //     // Cập nhật giá trị của input hidden
    //     inputSelectedProductIds.value = selectedProductIds.join(',');
    // }
    //
    // function toggleSelectAll(selectAllCheckbox) {
    //     const checkboxes = document.querySelectorAll('.product-checkbox');
    //     checkboxes.forEach(checkbox => {
    //         checkbox.checked = selectAllCheckbox.checked;
    //     });
    //     calculateTotal();
    // }
    //
    // function updateQuantity(button, action) {
    //     // Lấy productId từ thuộc tính data-id
    //     const productId = button.getAttribute('data-id');
    //
    //     // Lấy input số lượng
    //     const quantityInput = document.getElementById('quantityInput_' + productId);
    //     let currentQuantity = parseInt(quantityInput.value);
    //
    //     // Tăng/giảm số lượng
    //     if (action === 'plus') {
    //         currentQuantity++;
    //     } else if (action === 'minus' && currentQuantity > 1) {
    //         currentQuantity--;
    //     } else {
    //         alert("Số lượng không hợp lệ!");
    //         return;
    //     }
    //
    //     // Cập nhật UI trước khi gửi yêu cầu
    //     quantityInput.value = currentQuantity;
    //
    //     const pricePerItem = parseFloat(button.closest('tr').querySelector('td:nth-child(7)').innerText.replace(/[^0-9.-]+/g, ""));
    //     const totalPriceElement = document.getElementById('totalPrice_' + productId);
    //
    //     // Cập nhật giá tiền cho sản phẩm trong giỏ hàng
    //     totalPriceElement.innerText = formatCurrency(pricePerItem * currentQuantity);
    //
    //     // Gửi yêu cầu đến server
    //     fetch('/TTAP/cart/updateProductQuantity', {
    //         method: 'POST',
    //         headers: {
    //             'Content-Type': 'application/x-www-form-urlencoded'
    //         },
    //         body: `productId=${productId}&newQuantity=${currentQuantity}`
    //     })
    //         .then(response => response.json())
    //         .then(data => {
    //             if (data.error) {
    //                 alert(data.error);
    //                 // Reset số lượng nếu có lỗi
    //                 quantityInput.value = parseInt(quantityInput.getAttribute('value'));
    //             } else {
    //                 // Cập nhật số lượng mới trong giao diện
    //                 quantityInput.value = currentQuantity;
    //                 quantityInput.setAttribute('value', currentQuantity);
    //                 // if (data.totalPrice) {
    //                 //     const totalPriceElement = document.getElementById('totalPrice_' + productId);
    //                 //     totalPriceElement.innerText = numberUtils.formatCurrency(data.totalPrice);
    //                 // }
    //             }
    //         })
    //         .catch(error => {
    //             alert("Có lỗi xảy ra: " + error.message);
    //             // Reset số lượng nếu có lỗi không mong muốn
    //             quantityInput.value = parseInt(quantityInput.getAttribute('value'));
    //         });
    //     calculateTotal();
    // }
    // function formatCurrency(value) {
    //     // Sử dụng Intl.NumberFormat để định dạng theo kiểu Việt Nam
    //     const formatter = new Intl.NumberFormat('vi-VN', {
    //         style: 'decimal',
    //         minimumFractionDigits: 0,
    //         maximumFractionDigits: 0
    //     });
    //     return formatter.format(value) + " đ"; // Thêm "đ" vào cuối
    // }
</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script th:src="@{/js/banhang.js}"></script>
<script src="/js/toastMessage.js"></script>
<script th:inline="javascript">
    /*<![CDATA[*/
    var removemessage = [[${removemessage}]];
    console.log(removemessage);  // Debugging line to ensure the attribute is set
    if (removemessage) {
        toastSuccess('Thành Công!', 'Sản phẩm đã được xóa khỏi giỏ hàng!');
    }
    /*]]>*/x
</script>

<footer th:replace="~{/fragment/footer-customer :: footer-customer}" class="text-center">
    <p>&copy; 2024 TTAP T-SHIRT. All rights reserved.</p>
</footer>
</body>
</html>
